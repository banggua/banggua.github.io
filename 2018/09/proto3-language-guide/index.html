<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.69.0 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Li Zebang">
<meta name="keywords" content="proto3, guide">
<meta name="description" content="本文介绍了如何使用 protocol buffer 构建 pb 数据 &ndash; 包括 .proto 语法以及生成数据访问类的方法。">


<meta property="og:description" content="本文介绍了如何使用 protocol buffer 构建 pb 数据 &ndash; 包括 .proto 语法以及生成数据访问类的方法。">
<meta property="og:type" content="article">
<meta property="og:title" content="Proto3 语言指南">
<meta name="twitter:title" content="Proto3 语言指南">
<meta property="og:url" content="https://blog.guagua.tech/2018/09/proto3-language-guide/">
<meta property="twitter:url" content="https://blog.guagua.tech/2018/09/proto3-language-guide/">
<meta property="og:site_name" content="Li Zebang&#39;s Home">
<meta property="og:description" content="本文介绍了如何使用 protocol buffer 构建 pb 数据 &ndash; 包括 .proto 语法以及生成数据访问类的方法。">
<meta name="twitter:description" content="本文介绍了如何使用 protocol buffer 构建 pb 数据 &ndash; 包括 .proto 语法以及生成数据访问类的方法。">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2018-09-24T00:00:00">
  
  
    <meta property="article:modified_time" content="2018-09-24T00:00:00">
  
  
  
    
      <meta property="article:section" content="tool">
    
  
  
    
      <meta property="article:tag" content="golang">
    
      <meta property="article:tag" content="proto3">
    
      <meta property="article:tag" content="guide">
    
  


<meta name="twitter:card" content="summary">








  <meta property="og:image" content="https://blog.guagua.tech/images/cover.jpeg">
  <meta property="twitter:image" content="https://blog.guagua.tech/images/cover.jpeg">




  <meta property="og:image" content="https://avatars2.githubusercontent.com/u/26663453?s=460&v=4">
  <meta property="twitter:image" content="https://avatars2.githubusercontent.com/u/26663453?s=460&v=4">


    <title>Proto3 语言指南</title>

    <link rel="icon" href="https://blog.guagua.tech/favicon.png">
    

    

    <link rel="canonical" href="https://blog.guagua.tech/2018/09/proto3-language-guide/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://blog.guagua.tech/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://blog.guagua.tech/">Li Zebang&#39;s Home</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://blog.guagua.tech/#about">
    
    
    
      
        <img class="header-picture" src="https://avatars2.githubusercontent.com/u/26663453?s=460&amp;v=4" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://blog.guagua.tech/#about">
          <img class="sidebar-profile-picture" src="https://avatars2.githubusercontent.com/u/26663453?s=460&amp;v=4" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Li Zebang</h4>
        
          <h5 class="sidebar-profile-bio">I hear and I forget, I see and I remember, I do and I understand.</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
<li class="sidebar-button">
  
    <a class="sidebar-button-link " href="https://blog.guagua.tech/">
       <i class="sidebar-button-icon fa fa-lg fa-home"></i> 
      <span class="sidebar-button-desc">Home</span>
    </a>
</li>

<li class="sidebar-button">
  
    <a class="sidebar-button-link " href="https://blog.guagua.tech/categories">
       <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i> 
      <span class="sidebar-button-desc">Categories</span>
    </a>
</li>

<li class="sidebar-button">
  
    <a class="sidebar-button-link " href="https://blog.guagua.tech/tags">
       <i class="sidebar-button-icon fa fa-lg fa-tags"></i> 
      <span class="sidebar-button-desc">Tags</span>
    </a>
</li>

<li class="sidebar-button">
  
    <a class="sidebar-button-link " href="https://blog.guagua.tech/archives">
       <i class="sidebar-button-icon fa fa-lg fa-archive"></i> 
      <span class="sidebar-button-desc">Archives</span>
    </a>
</li>

<li class="sidebar-button">
  
    <a class="sidebar-button-link " href="https://blog.guagua.tech/#about">
       <i class="sidebar-button-icon fa fa-lg fa-question"></i> 
      <span class="sidebar-button-desc">About</span>
    </a>
</li>

    </ul>
    <ul class="sidebar-buttons">
      
<li class="sidebar-button">
  
  <a class="sidebar-button-link " href="https://github.com/banggua"
    target="_blank" rel="noopener">
     <i class="sidebar-button-icon fa fa-lg fa-github"></i> 
      <span class="sidebar-button-desc">GitHub</span>
    </a>
</li>

<li class="sidebar-button">
  
  <a class="sidebar-button-link " href="https://stackoverflow.com/users/9499576/li-zebang"
    target="_blank" rel="noopener">
     <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i> 
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
</li>

<li class="sidebar-button">
  
  <a class="sidebar-button-link " href="mailto:202559587@qq.com"
    target="_blank" rel="noopener">
     <i class="sidebar-button-icon fa fa-lg fa-envelope"></i> 
      <span class="sidebar-button-desc">E-mail</span>
    </a>
</li>

    </ul>
    <ul class="sidebar-buttons">
      
<li class="sidebar-button">
  
    <a class="sidebar-button-link " href="https://blog.guagua.tech/index.xml">
       <i class="sidebar-button-icon fa fa-lg fa-rss"></i> 
      <span class="sidebar-button-desc">RSS</span>
    </a>
</li>

    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-center
              "
       style="background-image:url('/images/cover.jpeg')"
       data-behavior="4">
    
      <div class="post-header main-content-wrap text-center">
  
    <h1 class="post-title" itemprop="headline">
      Proto3 语言指南
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-09-24T00:00:00Z">
        
  September 24, 2018

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://blog.guagua.tech/categories/tool">tool</a>
    
  

  </div>

</div>
    
  </div>


      <div id="main" data-behavior="4"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>本文介绍了如何使用 protocol buffer 构建 pb 数据 &ndash; 包括 <code>.proto</code> 语法以及生成数据访问类的方法。</p>
<p><a href="https://github.com/lizebang/learning-proto3">Demo Code</a></p>
<h2 id="message-类型">Message 类型</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf">syntax <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;proto3&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">SearchRequest</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">string</span> query <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">int32</span> page_number <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">int32</span> result_per_page <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><ul>
<li>文件第一行指定使用 <code>proto3</code> 格式，默认 <code>proto2</code>。</li>
<li><code>SearchRequest</code> 中定义了三个字段，每个字段由 类型、名称、编号 组成。</li>
<li>在 Go 中，<code>message SearchRequest</code> 等于 <code>message search_request</code>，字段使用下划线 <code>_</code> 指明驼峰法大写字母（首字母除外）。</li>
</ul>
<h3 id="字段类型">字段类型</h3>
<p>字段类型可以是基本类型，也可以是 <code>enum</code>、<code>message</code> 这样的复合类型。</p>
<h3 id="字段编号">字段编号</h3>
<p>在一个 <code>message</code> 中，每个字段都有唯一的编号。编号范围为 1 ~ $2^{29}$-1，即 1 ~ 536,870,911，其中 19000 ~ 19999 也不可以使用。1 ~ 15 占一个字节，16 ~ 2047 占两个字节。</p>
<h3 id="字段规则">字段规则</h3>
<ul>
<li>singular：零或一次。</li>
<li><code>repeated</code>：重复任意次数（包括零），并且编码保留顺序。</li>
</ul>
<p>在 proto3 中，<code>repeated</code> 对基本类型字段默认使用 <code>packed</code> 编码。<code>repeated</code> 在 Go 中表现为 slice。</p>
<h3 id="多个-message">多个 Message</h3>
<p>多个 <code>message</code> 类型可以定义在同一文件中。</p>
<h3 id="注解">注解</h3>
<p>使用 C/C++ 风格，<code>//</code> 和 <code>/* ... */</code> 语法。</p>
<h3 id="保留字段">保留字段</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">Foo</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  reserved <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">9</span> <span style="color:#66d9ef">to</span> <span style="color:#ae81ff">11</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  reserved <span style="color:#e6db74">&#34;foo&#34;</span>, <span style="color:#e6db74">&#34;bar&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>在 <code>Foo</code> 不可以使用 <code>foo</code> <code>bar</code> 作字段名称，不可以使用 <code>2, 15, 9 ~ 11</code> 作字段编号。</p>
<h3 id="将生成什么">将生成什么</h3>
<ul>
<li><code>C++</code>：生成一个 <code>.h</code> 和一个 <code>.cc</code> 文件，并为文件中描述的每种消息类型提供一个类。</li>
<li><code>Java</code>：生成一个 <code>.java</code> 文件，其中包含每种消息类型的类，以及用于创建消息类实例的特殊类 <code>Builder</code> 。</li>
<li><code>Python</code>：有点不同 &ndash; 为文件中描述的每种消息类型生成一个带有静态描述符的模块，它和 <strong>metaclass</strong> 一起使用，以在 runtime 上创建必要的 Python 数据访问类。</li>
<li><code>Go</code>：生成一个 <code>.pb.go</code> 文件，其中包含文件中描述的每种消息类型。</li>
<li><code>Ruby</code>：生成一个 <code>.rb</code> 文件，其中包含消息类型的 Ruby 模块。</li>
<li><code>Objective-C</code>：生成一个 <code>pbobjc.h</code> 和一个 <code>pbobjc.m</code> 文件，其中包含文件中描述的每种消息类型的类。</li>
<li><code>C#</code>：生成一个 <code>.cs</code> 文件，其中包含文件中描述的每种消息类型的类。</li>
</ul>
<h2 id="基本类型">基本类型</h2>
<p>基本类型对应规则参见 <a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar">官方表格</a> 和 <a href="https://developers.google.com/protocol-buffers/docs/encoding">编码方式</a>。</p>
<h2 id="默认值">默认值</h2>
<ul>
<li><code>string</code>：空字符串</li>
<li><code>bytes</code>：空字节切片</li>
<li>bool：false</li>
<li>numeric：0</li>
<li>enum：第一个枚举值，0</li>
<li>message：未设置该字段，依编程语言而定（Go 中为 nil）</li>
</ul>
<h2 id="枚举类型">枚举类型</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">SearchRequest</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">string</span> query <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">int32</span> page_number <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">int32</span> result_per_page <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">enum</span> Corpus {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    UNIVERSAL <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    WEB <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    IMAGES <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    LOCAL <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    NEWS <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    PRODUCTS <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    VIDEO <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  Corpus corpus <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>枚举第一个值必须映射为 0，原因如下：</p>
<ul>
<li>必须有一个零值，以便将其作为默认值。</li>
<li>零值必须是第一个元素，以便与 proto2 语义兼容，第一个枚举值始终是默认值。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">enum</span> EnumAllowingAlias {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">option</span> allow_alias <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  UNKNOWN <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  STARTED <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  RUNNING <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">enum</span> EnumNotAllowingAlias {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  UNKNOWN <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  STARTED <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e">// RUNNING = 1;  // Uncommenting this line will cause a compile error inside Google and a warning message outside.
</span><span style="color:#75715e"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p><code>allow_alias</code> 允许使用别名，如 <code>STARTED</code> 和 <code>RUNNING</code> 都映射为 1。</p>
<p>枚举类型可以定义在消息内，也可以定义在消息外。<code>message</code> 通过 <code>MessageType.EnumType</code> 使用其他消息中定义的 <code>enum</code>。</p>
<p>在反序列化期间，将在消息中保留无法识别的枚举值，但如何表示这种值取决于编程语言。在 Go 中，未知的枚举值仅作为其基础整数表示存储。在任何情况下，如果消息被序列化，则仍然会使用消息序列化无法识别的值。</p>
<p>枚举也可以设置保留值。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">enum</span> Foo {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  reserved <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">9</span> <span style="color:#66d9ef">to</span> <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">40</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">max</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  reserved <span style="color:#e6db74">&#34;FOO&#34;</span>, <span style="color:#e6db74">&#34;BAR&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h2 id="message-中使用其他-message">Message 中使用其他 Message</h2>
<p>可以使用其他 <code>message</code> 类型作为字段类型。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">SearchResponse</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">repeated</span> Result results <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">Result</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">string</span> url <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">string</span> title <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">repeated</span> <span style="color:#66d9ef">string</span> snippets <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h3 id="导入定义">导入定义</h3>
<p>使用 import 导入定义。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;myproject/other_protos.proto&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>将定义移到新的位置，需要在旧位置放置一个虚拟文件，使用 <code>import public</code> 将所有导入转移到新位置。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#75715e">// new.proto
</span><span style="color:#75715e">// All definitions are moved here
</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#75715e">// old.proto
</span><span style="color:#75715e">// This is the proto that all clients are importing.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> public <span style="color:#e6db74">&#34;new.proto&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;other.proto&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#75715e">// client.proto
</span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;old.proto&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">// You use definitions from old.proto and new.proto, but not other.proto
</span></code></pre></div><p>编译时使用 <code>-I</code>/<code>-IPATH</code>/<code>--proto_path</code> 指定项目的根目录。</p>
<h3 id="使用-proto2-message-类型">使用 proto2 Message 类型</h3>
<p>在 <code>proto3</code> 中，可以导入并使用 <a href="https://developers.google.com/protocol-buffers/docs/proto">proto2</a> 消息类型，反之亦然。注意：<code>proto3</code> 不能直接使用 <code>proto2</code> <code>enum</code> 类型，需要将 <code>enum</code> 放到消息中使用。</p>
<h2 id="嵌套类型">嵌套类型</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">SearchResponse</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">message</span> <span style="color:#a6e22e">Result</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">string</span> url <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">string</span> title <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">repeated</span> <span style="color:#66d9ef">string</span> snippets <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">repeated</span> Result results <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>在消息中通过 <code>Parent.Type</code> 的方式使用其他消息中的 <code>message</code> 类型：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">SomeOtherMessage</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  SearchResponse.Result result <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>你可以根据需要进行多层嵌套。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">Outer</span> {      <span style="color:#75715e">// Level 0
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">message</span> <span style="color:#a6e22e">MiddleAA</span> { <span style="color:#75715e">// Level 1
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">message</span> <span style="color:#a6e22e">Inner</span> {  <span style="color:#75715e">// Level 2
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">int64</span> ival <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      <span style="color:#66d9ef">bool</span>  booly <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">message</span> <span style="color:#a6e22e">MiddleBB</span> { <span style="color:#75715e">// Level 1
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">message</span> <span style="color:#a6e22e">Inner</span> {  <span style="color:#75715e">// Level 2
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">int32</span> ival <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      <span style="color:#66d9ef">bool</span>  booly <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h2 id="更新-message-类型">更新 Message 类型</h2>
<p>在不破坏任何现有代码的情况下更新消息需遵循以下规则：</p>
<ul>
<li>请勿更改任何现有字段的编号。</li>
<li>如果添加新字段，则旧格式的消息仍然被新生成的代码解析。你应该记住这些元素的 <a href="https://developers.google.com/protocol-buffers/docs/proto3#default">默认值</a>，以便新代码可以正确地与旧代码生成的消息进行交互。同样地，新代码生成的消息也可以被旧代码解析：旧二进制文件在解析式忽略新字段。有关信息请查看 <a href="https://developers.google.com/protocol-buffers/docs/proto3#unknowns">未知字段</a>。</li>
<li>只要在更新的消息类型中不再使用此字段编号，就字段就可以被移除。你可能想重命名该字段，可以添加前缀 &ldquo;OBSOLETE_&quot;，或者让字段编号 <a href="https://developers.google.com/protocol-buffers/docs/proto3#reserved">保留</a>，以便 <code>.proto</code> 不会在未来意外地重复使用该字段编号。</li>
<li><code>int32</code>、<code>uint32</code>、<code>int64</code>、<code>uint64</code> 和 <code>bool</code> 都是兼容的 &ndash; 这代表你可以任意改变字段类型而不破坏向前、向后的兼容性。如果从线路中解析出一个不符合相应类型的数字，你将获得与 C++ 中将数字转换成所定义类型相同的效果（例如，如果将 64 位数字作为 int32 读取，他将被截断为 32 位数字）。</li>
<li><code>sint32</code> 和 <code>sint64</code> 彼此兼容，但不与其他整型兼容。</li>
<li>只要 <code>bytes</code> 是有效的 UTF-8，<code>string</code> 和 <code>bytes</code> 彼此兼容。</li>
<li>如果 <code>bytes</code> 包含 <code>message</code> 编码的版本，内置的 <code>message</code> 与 <code>bytes</code> 兼容。</li>
<li><code>fixed32</code> 与 <code>sfixed32</code> 兼容，<code>fixed64</code> 与 <code>sfixed64</code> 兼容。</li>
<li><code>enum</code> 与 <code>int32</code>、<code>uint32</code>、<code>int64</code> 和 <code>uint64</code> 在有线格式方面兼容（注意，如果值不合适将会被截断）。但请注意，在反序列化消息时，客户端代码可能会以不同的方式对待它们：例如，无法识别的 proto3 <code>enum</code> 类型将保留在消息中，但是，当反序列化消息时，如何表示它依赖于语言。Int 字段总是保留它们的值。</li>
<li>将单个的值改为新类型 <code>oneof</code> 是安全且二进制兼容的。如果你确定没有没有代码一次设置多个字段，则将多个字段移到一个新的 <code>oneof</code> 可能是安全的。将多个字段移到一个已经存在的 <code>oneof</code> 中是不安全的。</li>
</ul>
<h2 id="未知字段">未知字段</h2>
<p>未知字段是解析器无法识别的字段。例如，当旧二进制文件解析具有新字段的新二进制文件发送的数据时，这些新字段将成为旧二进制文件中的未知字段。</p>
<p>最初，proto3 消息总是在解析时丢弃未知字段，但是在 3.5 版本中，我们重新引入了保存未知字段的行为以匹配 proto2。在 3.5 及更高的版本中，未知字段在解析期间保留并包含在序列化输出中。</p>
<h2 id="any">Any</h2>
<p><code>Any</code> 消息类型允许你在没有 <code>.proto</code> 定义的情况下将消息用于嵌入类型。<code>Any</code> 包含存储任意序列化消息的 <code>bytes</code>，以及用于作为该消息类型全局标识和解析消息类型的 URL。要使用 <code>Any</code> 类型，你需要导入 <code>google/protobuf/any.proto</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;google/protobuf/any.proto&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">ErrorStatus</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">string</span> <span style="color:#66d9ef">message</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">repeated</span> google.protobuf.Any details <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>给定消息类型默认的 URL 是 <code>type.googleapis.com/packagename.messagename</code>。</p>
<p>Go 中 Any 的具体使用请看 <a href="https://github.com/lizebang/learning-proto3/tree/master/any">示例</a>。</p>
<h2 id="oneof">Oneof</h2>
<p>如果你有一个包含许多字段的消息，但是它同时最多只能设置一个字段，则可以使用 <code>oneof</code> 功能强制执行此行为以节省内存。</p>
<p>除了所有字段在共享内存中以及同一时间最多设置一个字段外，<code>oneof</code> 字段和普通字段一样。设置 <code>oneof</code> 中的任何成员都会清除所有其他成员。如果有 <code>case()</code> 或 <code>WhichOneof()</code> 方法可以使用它们检查哪个值在 <code>oneof</code> 中，当然完全取决于你选择的编程语言。</p>
<h3 id="使用-oneof">使用 Oneof</h3>
<p>要在 <code>.proto</code> 中使用 oneof，只需要在 <code>oneof</code> 名称前加上 <code>oneof</code> 关键字，你可以使用任何类型的字段，但是不能使用 <code>repeated</code> 字段。，例如 <code>test_oneof</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">SampleMessage</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">oneof</span> test_oneof {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">string</span> name <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    SubMessage sub_message <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>在生成的代码中，<code>oneof</code> 字段和普通字段一样拥有 getter 和 setter 方法。如果有，你还可以使用特殊的方法检查哪个值是 <code>oneof</code> 设置的。</p>
<h3 id="oneof-的特征">Oneof 的特征</h3>
<ul>
<li>设置一个 <code>oneof</code> 成员将自动清除所有其他 <code>oneof</code> 成员。所以，如果你设置了多个 <code>oneof</code> 字段，只有最后你设置的字段仍然有值。
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf">SampleMessage message;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>message.set_name(<span style="color:#e6db74">&#34;name&#34;</span>);<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>CHECK(message.has_name());<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>message.mutable_sub_message(); <span style="color:#75715e">// Will clear name field.
</span><span style="color:#75715e"></span>CHECK(<span style="color:#960050;background-color:#1e0010">!</span>message.has_name());<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div></li>
<li>如果解析器在线路上遇到同一 <code>oneof</code> 中存在多个成员，则被解析的消息只有最后一个成员可见。</li>
<li><code>oneof</code> 不能为 <code>repeated</code>。</li>
<li>Reflection APIs 适用于 <code>oneof</code> 字段。</li>
<li>如果你使用的是 C++，请确保你的代码不会导致内存崩溃。下面的示例代码会导致崩溃，因为由于调用了 <code>set_name()</code> 方法 <code>sub_message</code> 已经被删除了。
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf">SampleMessage message;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>SubMessage<span style="color:#960050;background-color:#1e0010">*</span> sub_message <span style="color:#f92672">=</span> message.mutable_sub_message();<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>message.set_name(<span style="color:#e6db74">&#34;name&#34;</span>); <span style="color:#75715e">// Will delete sub_message
</span><span style="color:#75715e"></span>sub_message<span style="color:#f92672">-</span>&gt;set_...      <span style="color:#75715e">// Crashes here
</span></code></pre></div></li>
<li>同样在 C++ 中，如果你使用 <code>oneofs</code> 来 <code>Swap()</code> 两个消息。两个消息最终将变成对方所拥有的 <code>oneof</code> 字段，在下面的示例中：<code>msg1</code> 将拥有 <code>sub_message</code> 而 <code>msg2</code> 将拥有 <code>name</code>。
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf">SampleMessage msg1;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>msg1.set_name(<span style="color:#e6db74">&#34;name&#34;</span>);<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>SampleMessage msg2;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>msg2.mutable_sub_message();<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>msg1.swap(<span style="color:#960050;background-color:#1e0010">&amp;</span>msg2);<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>CHECK(msg1.has_sub_message());<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>CHECK(msg2.has_name());<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div></li>
</ul>
<h3 id="向后兼容问题">向后兼容问题</h3>
<p>在添加或移除 <code>oneof</code> 字段时需要格外小心。如果检查 <code>oneof</code> 的值返回为 <code>None</code>/<code>NOT_SET</code> 时，它可能意味着 <code>oneof</code> 还没有被设置或者它在不同版本的 <code>oneof</code> 中设置了字段。因为没有办法知道一个未知字段是否是 <code>oneof</code> 的成员，所以没有办法将他们区分开。</p>
<h3 id="标签重用问题">标签重用问题</h3>
<ul>
<li>**将字段移入或移出 <code>oneof</code>：**在消息被序列化和解析的过程中，你可以会丢失一些信息（某些字段将被清除）。但是，你可以安全地将单个字段移动到新的 <code>oneof</code> 中，并且如果知道只有一个字段被设置也可以添加多个字段。</li>
<li>**删除 <code>oneof</code> 字段并将其添回：**在消息被序列化和解析后，这可能清除你当前设置的 <code>oneof</code> 字段。</li>
<li>**拆分或合并 <code>oneof</code>：**与移动普通字段问题类似。</li>
</ul>
<h2 id="map">Map</h2>
<p>如果要在数据定义中创建关联 <code>map</code>，pb 提供了一种便捷的语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf">map&lt;key_type, value_type&gt; map_field <span style="color:#f92672">=</span> N;<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>&hellip;其中 <code>key_type</code> 可以是任意整型或字符串（即，除浮点类型和 <code>bytes</code> 的任何 <a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar">标量</a> 类型）。注意，enum 不是有效的 <code>key_type</code>。<code>value_type</code> 可以是除 <code>map</code> 外的任意类型。</p>
<p>因此，例如，如果要创建 projects <code>map</code>，其中每条 <code>Project</code> 消息都与字符串相关联，则可以像下面这样定义它：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf">map&lt;<span style="color:#66d9ef">string</span>, Project&gt; projects <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><ul>
<li><code>map</code> 字段不能使用 <code>repeated</code>。</li>
<li><code>map</code> 值不具有有线格式排序和映射迭代排序，因此你不能依赖于特定顺序的 <code>map</code> 条目。</li>
<li>生成 <code>.proto</code> 的文本格式时，<code>map</code> 按键排序。数字键按数字排序。</li>
<li>从线路解析或合并时，如果有重复的 <code>map</code> 键，则使用最后的键。从文本格式解析 <code>map</code> 时，如果存在重复键，则解析可能失败。</li>
<li>如果为 <code>map</code> 字段提供的键没有值，则字段序列化时的行为由编程语言决定。在 C++、Java 和 Python 中，类型的默认值被序列化，而在其他语言中没有序列化。</li>
</ul>
<h3 id="向后兼容问题-1">向后兼容问题</h3>
<p>在线路上，<code>map</code> 的语法等同于下面的示例，因此不支持 <code>map</code> 的 pb 实现仍然可以处理你的数据：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">MapFieldEntry</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  key_type key <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  value_type value <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">repeated</span> MapFieldEntry map_field <span style="color:#f92672">=</span> N;<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h2 id="package">Package</h2>
<p>你可以添加一个可选的 <code>package</code> 说明符到 <code>.proto</code> 文件，以防止协议消息类型之间到名称发生冲突。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#f92672">package</span> foo<span style="color:#f92672">.</span>bar;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">Open</span> { <span style="color:#f92672">...</span> }<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>你可以在定义消息类型的字段时使用 <code>package</code> 说明符。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">Foo</span> {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#f92672">...</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  foo.bar.Open open <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#f92672">...</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p><code>package</code> 说明符影响生成的代码的方式取决于所选择的编程语言：</p>
<ul>
<li>在 <strong>C++</strong> 中，生成的类包含在 C++ 命名空间中。例如，Open 将在命名空间中 <code>foo::bar</code>。</li>
<li>在 <strong>Java</strong> 中，除非在 <code>.proto</code> 文件中明确提供 <code>option java_package</code>，否则 <code>package</code> 将用作 Java 包名。</li>
<li>在 <strong>Python</strong> 中，<code>package</code> 指令被忽略，因为 Python 模块是根据它们在文件系统中的位置进行组织的。</li>
<li>在 <strong>Go</strong> 中，除非在 <code>.proto</code> 文件中明确提供 <code>option go_package</code>，否则 <code>package</code> 将用作 Go 包名。</li>
<li>在 <strong>Ruby</strong> 中，生成到类被包装在嵌套的 Ruby 命名空间中，并被转换为所需要的 Ruby 大小写样式（首字母大写，如果第一个字符不是字母，则在前面附加上 <code>PB_</code>）。例如，<code>Open</code> 将在命名空间中 <code>Foo::Bar</code>。</li>
<li>在 <strong>C#</strong> 中，<code>package</code> 转换为 PascalCase 后被用作命名空间，除非你在 <code>.proto</code> 文件中明确提供 <code>option csharp_namespace</code>。例如，<code>Open</code> 将在命名空间中 <code>Foo::Bar</code>。</li>
</ul>
<h3 id="包和名称的解析">包和名称的解析</h3>
<p>在 pb 中，类型名的解析与 C++ 类似：首先搜索最内层的作用域，然后是次内层的，以此类推。每个包认为内部的包是其父包。开头的 <code>.</code>（例如，<code>.foo.bar.Baz</code>）意味着从最外层的作用域开始的。</p>
<p>pb 编译器通过解析导入的 <code>.proto</code> 文件来解析所有类型的名称。每种语言的代码生成器都知道任何使用该语言去对应每一种类型，即使它们有不同的作用域规范。</p>
<h2 id="定义-service">定义 Service</h2>
<p>如果你想要将消息类型和 RPC（远程过程调用）系统一起使用，你可以在 <code>.proto</code> 文件中定义一个 RPC 服务接口并 pb 编译器将生成你所选语言的服务接口代码和存根。例如，如果你想定义一个使用 <code>SearchRequest</code> 并返回 <code>SearchResponse</code> 的 RPC 服务，你可以像下面这样在 <code>.proto</code> 文件中定义它：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#66d9ef">service</span> SearchService {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#66d9ef">rpc</span> Search (SearchRequest) <span style="color:#66d9ef">returns</span> (SearchResponse);<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>与 pb 一起使用的最简单的 RPC 系统是 <a href="https://grpc.io/">gRPC</a>：一种 Google 开发的语言中立和平台中立的开源的 RPC 系统。gRPC 特别适用于 pb 并允许你使用特定的 pb 编译器插件直接由 <code>.proto</code> 文件生成相关的 RPC 代码。</p>
<p>如果你不想使用 gRPC，也可以将 pb 与你自己实现的 RPC 一起使用。详情请看 [Proto2 语言指南]。</p>
<p>还有一些正在进行的第三方项目为 pb 开发的 RPC 实现。更多请查看 <a href="https://github.com/google/protobuf/blob/master/docs/third_party.md">wiki</a></p>
<h2 id="json-映射">JSON 映射</h2>
<p>Proto3 支持 JSON 中的规范编码，使得系统间共享数据变得更加容易。下表介绍了每一种类型的编码方式。</p>
<p>如果 JSON 编码的数据中缺少某个值或其值为 null，则在解析为 pb 时将其解释为相应的默认值。如果字段在 pb 中有默认值，则默认情况下将在 JSON 编码数据中省略该字段以节省空间。pb 的实现可以提供用于在 JSON 编码的输出中具有具有默认值的字段的选项。</p>
<table>
<thead>
<tr>
<th align="left">proto3</th>
<th align="left">JSON</th>
<th align="left">JSON example</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">message</td>
<td align="left">object</td>
<td align="left">{&ldquo;fooBar&rdquo;: v, &ldquo;g&rdquo;: null, &hellip;}</td>
<td align="left">生成JSON对象。消息字段名映射到 lowerCamelCase 并成为 JSON 对象的键。如果指定了 <strong>json_name</strong> 字段选项，则指定的值将用作键。解析器接受 lowerCamelCase 名称（或 <strong>json_name</strong> 选项指定的名称）和原始 proto 字段名。null 是所有字段类型的可接受值，并被视为相应字段类型的默认值。</td>
</tr>
<tr>
<td align="left">enum</td>
<td align="left">string</td>
<td align="left">&ldquo;FOO_BAR&rdquo;</td>
<td align="left">enum 值的名称同指定 proto 中使用的值一样。解析器接受 enum 名和整数值。</td>
</tr>
<tr>
<td align="left">map&lt;K,V&gt;</td>
<td align="left">object</td>
<td align="left">{&ldquo;k&rdquo;: v, &hellip;}</td>
<td align="left">所有的键都转换为字符串。</td>
</tr>
<tr>
<td align="left">repeated V</td>
<td align="left">array</td>
<td align="left">[v, &hellip;]</td>
<td align="left">接受 <strong>null</strong> 值并视为空列表 []。</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">true, false</td>
<td align="left">true, false</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">string</td>
<td align="left">&ldquo;Hello World!&rdquo;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">bytes</td>
<td align="left">base64 string</td>
<td align="left">&ldquo;YWJjMTIzIT8kKiYoKSctPUB+&rdquo;</td>
<td align="left">JSON 值是使用带填充的标准 base64 编码的字符串。接受 带填充/不带填充 的 标准/URL 安全的 base64 编码。</td>
</tr>
<tr>
<td align="left">int32, fixed32, uint32</td>
<td align="left">number</td>
<td align="left">1, -10, 0</td>
<td align="left">JSON 值是十进制数。接受数字和字符串。</td>
</tr>
<tr>
<td align="left">int64, fixed64, uint64</td>
<td align="left">string</td>
<td align="left">&ldquo;1&rdquo;, &ldquo;-10&rdquo;</td>
<td align="left">JSON 值是十进制字符串。接受数字和字符串。</td>
</tr>
<tr>
<td align="left">float, double</td>
<td align="left">number</td>
<td align="left">1.1, -10.0, 0, &ldquo;NaN&rdquo;, &ldquo;Infinity&rdquo;</td>
<td align="left">JSON 值是数字或特殊的字符串 &ldquo;NaN&rdquo;、&ldquo;Infinity&rdquo; 和 &ldquo;-Infinity&rdquo;。接受数字、字符串和指数表示法。</td>
</tr>
<tr>
<td align="left">Any</td>
<td align="left">object</td>
<td align="left">{&quot;@type&rdquo;: &ldquo;url&rdquo;, &ldquo;f&rdquo;: v, &hellip;}</td>
<td align="left">如果 Any 包含具有特殊 JSON 映射的值，它将按如下方式转换：<strong>{&quot;@type&rdquo;: xxx, &ldquo;value&rdquo;: yyy}</strong>。否则，值将被转换成一个 JSON 对象，并将插入 &ldquo;@type&rdquo; 字段以指出实际的数据类型。</td>
</tr>
<tr>
<td align="left">Timestamp</td>
<td align="left">string</td>
<td align="left">&ldquo;1972-01-01T10:00:20.021Z&rdquo;</td>
<td align="left">使用 RFC3339 标准，其中生成的结果始终被 Z 标准化并使用 0、3、6 或 9 位小数。接受 &ldquo;Z&rdquo; 以外的偏移。</td>
</tr>
<tr>
<td align="left">Duration</td>
<td align="left">string</td>
<td align="left">&ldquo;1.000340012s&rdquo;, &ldquo;1s&rdquo;</td>
<td align="left">生成的结果始终包含 0、3、6 或 9 位小数，具体取决于所需的精度，结果后跟着后缀 &ldquo;s&rdquo;。接受任何小数位（也可以没有），只要它们符合纳秒精度并且跟有后缀 &ldquo;s&rdquo;。</td>
</tr>
<tr>
<td align="left">Struct</td>
<td align="left">object</td>
<td align="left">{ &hellip; }</td>
<td align="left">任何 JSON 对象。请查看 <strong>struct.proto</strong>。</td>
</tr>
<tr>
<td align="left">Wrapper types</td>
<td align="left">various types</td>
<td align="left">2, &ldquo;2&rdquo;, &ldquo;foo&rdquo;, true, &ldquo;true&rdquo;, null, 0, &hellip;</td>
<td align="left">Wrappers 在 JSON 中使用与包装原始类型，除了 <strong>null</strong> 是在数据转换和传输期间允许和保留。</td>
</tr>
<tr>
<td align="left">FieldMask</td>
<td align="left">string</td>
<td align="left">&ldquo;f.fooBar,h&rdquo;</td>
<td align="left">请查看 <strong>field_mask.proto</strong>。</td>
</tr>
<tr>
<td align="left">ListValue</td>
<td align="left">array</td>
<td align="left">[foo, bar, &hellip;]</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Value</td>
<td align="left">value</td>
<td align="left"></td>
<td align="left">任何 JSON 对象</td>
</tr>
<tr>
<td align="left">NullValue</td>
<td align="left">null</td>
<td align="left"></td>
<td align="left">JSON null</td>
</tr>
</tbody>
</table>
<h3 id="json-选项">JSON 选项</h3>
<p>一个 proto3 JSON 的实现提供下列选项：</p>
<ul>
<li>**发出具有默认值的字段：**默认情况下，proto3 JSON 输出中省略了具有默认值的字段。实现可以提供覆盖此行为的选项，并输出具有默认值的字段。</li>
<li>**忽略未知字段：**默认情况下，proto3 JSON 解析器应该拒绝未知字段，但是可以提供在解析时忽略未知字段的选项。</li>
<li>**使用 proto 字段名代替 lowerCamelCase 名：**默认情况下，proto3 JSON 应将字段名转换成 lowerCamelCase 名。实现可以提供使用 proto 字段名作为 JSON 名的选项。proto3 JSON 解析器需要接受转换后 lowerCamelCase 名和 proto 字段名。</li>
<li>**发出的 enum 值为整数而不是字符串：**默认情况下，在 JSON 输出中使用 <code>enum</code> 的名称。提供使用 <code>enum</code> 数值的选项。</li>
</ul>
<h2 id="option">Option</h2>
<p><code>.proto</code> 文件中的个别声明可以使用许多 <code>options</code> 进行注解。<code>Options</code> 不会改变声明的整体含义，但是可能会影响它处理特定上下文方式。可用选项的完整列表定义在 <code>google/protobuf/descriptor.proto</code> 中。</p>
<p>一些是文件级选项，这意味着它们应该在文件头部编写，而不是在任何 <code>message</code>、<code>enum</code>、<code>service</code> 定义中。一些选项是消息级的选项，这意味着它们应该写在 <code>massage</code> 定义中。一些选项是字段级的选项，这意味着它们应该写在字段定义中。选项也可以写在枚举类型、枚举值、服务类型，以及服务方法上，但是目前没有有用的选项供它们使用。</p>
<p>这里有一些最常用的选项：</p>
<ul>
<li><code>java_package</code>（文件选项）：用于生成的 Java 类的包。如果不在给定的 <code>.proto</code> 文件中明确 <code>java_package</code> 选项，则在默认情况下将使用 proto 包（使用 <code>.proto</code> 文件中的 &ldquo;package&rdquo; 关键字指定）。但是，proto 包通常不会生成友好的 Java 包，因为 proto 包不回以反向域名开头。如果不生成 Java 代码，则此选项无效。
<code>option java_package = &quot;com.example.foo&quot;;</code></li>
<li><code>java_multiple_files</code>（文件选项）：使 <code>message</code>、<code>enum</code> 以及 <code>service</code> 定义在不同的类中（不同的文件），而不是定义为内部类。
<code>option java_multiple_files = true;</code></li>
<li><code>java_outer_classname</code>（文件选项）：生成的最外层的 Java 类的类名（文件名）。如果没有在 <code>.proto</code> 文件中明确指定 <code>java_outer_classname</code>，则将 <code>.proto</code> 文件名转换为 camel-case 来构造类名（<code>foo_bar.proto</code> 会被转换为 <code>FooBar.java</code>）。如果不生成 Java 代码，则此选项无效。
<code>option java_outer_classname = &quot;Ponycopter&quot;;</code></li>
<li><code>optimize_for</code>（文件选项）：可以设置为 <code>SPEED</code>、<code>CODE_SIZE</code> 或 <code>LITE_RUNTIME</code>。这会以下列方式影响 C++ 和 Java 代码生成器（可能还有第三方生成器）：
<ul>
<li><code>SPEED</code>（默认）：pb 的编译器将生成用于消息类型进行序列化、解析和执行其他常见操作的代码。此代码经过高度优化。</li>
<li><code>CODE_SIZE</code>：pb 的编译器将生成最小的类，并依赖共享的、基于反射的代码实现序列化、解析和执行其他操作。生成的代码将比使用 <code>SPEED</code> 的小很多，但是操作会更慢。类仍然实现与 <code>SPEED</code> 模式完全相同的公有 API。此模式在包含数量非常大的 <code>.proto</code> 文件且不需要所有文件都非常迅速的应用程序中最有用。</li>
<li><code>LITE_RUNTIME</code>：pb 的编译器将生成仅依赖于 &ldquo;lite&rdquo; 运行时库的类（<code>libprotobuf-lite</code> 而不是 <code>libprotobuf</code>）。精简版运行时比整个库小得多（大约小一个数量级），但是省略了描述符和反射等特定功能。这对于移动电话等受限制平台上运行的应用程序尤其有用。编译器仍然会像在 <code>SPEED</code> 模式中一样生成所有方法的快速实现。生成的类将仅实现每种语言中的 <code>MessageLite</code> 接口，它只提供完整 <code>Message</code> 接口功能的子集。
<code>option optimize_for = CODE_SIZE;</code></li>
</ul>
</li>
<li><code>cc_enable_arenas</code>（文件选项）：为 C++ 生成的代码启用 <a href="https://developers.google.com/protocol-buffers/docs/reference/arenas">arena allocation</a>。</li>
<li><code>objc_class_prefix</code>（文件选项）：设置 Objective-C 类前缀，该前缀添加到用此 <code>.proto</code> 文件生成的 Objective-C 的类和枚举前。没有默认值。你应该使用 <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/Conventions/Conventions.html#//apple_ref/doc/uid/TP40011210-CH10-SW4">Apple 建议</a> 的 3-5 个大写字符之间的前缀。请注意，Apple 保留所有 2 个字母的前缀。</li>
<li><code>deprecated</code>（文件选项）：如果设置为 <code>true</code>，则表示该字段已弃用，新代码不应该使用该字段。在大多数语言中没有实际效果。在 Java 中，这个选项会生成一个 <code>@Deprecated</code> 的注解。将来，其他特定语言的代码生成器可能会在字段的访问器上生成弃用注释，这将导致在编译尝试使用该字段的代码时发出警告。如果你们没有人使用该字段，希望不要使用此字段并推荐使用 <a href="https://developers.google.com/protocol-buffers/docs/proto3#reserved">reserved</a> 声名。
<code>int32 old_field = 6 [deprecated=true];</code></li>
</ul>
<h3 id="自定义选项">自定义选项</h3>
<p>Protocol Buffers 还允许您定义和使用自己的选项。这是大多数人不需要的 <strong>高级功能</strong>。如果你确实需要创建自己的选项，请参阅 <a href="https://developers.google.com/protocol-buffers/docs/proto.html#customoptions">Proto2 语言指南</a> 以获取详细信息。请注意，创建自定义选项使用的 <a href="https://developers.google.com/protocol-buffers/docs/proto#extensions">extensions</a>，它们仅允许用于 proto3 中的自定义选项。</p>
<h2 id="生成数据访问类">生成数据访问类</h2>
<p>这里介绍 Go 使用的方法，其他语言参见 <a href="https://developers.google.com/protocol-buffers/docs/tutorials">官方教程</a>。</p>
<p>安装步骤：</p>
<p>1.macOS 上使用 Homebrew 安装 <code>brew install protobuf</code>，其他从 <a href="https://github.com/protocolbuffers/protobuf/releases">GitHub</a> 下载安装。</p>
<p>2.安装 <a href="https://golang.org/doc/install">Go</a> 并配置 <code>GOPATH</code> <code>GOBIN</code>，将 <code>GOBIN</code> 添加到 <code>PATH</code> 中。使用 gccgo 参见 <a href="https://golang.org/doc/install/gccgo">官方文档</a>。</p>
<p>3.使用 <code>go get -u github.com/golang/protobuf/protoc-gen-go</code> 完成插件安装。</p>
<p>生成访问类：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">protoc --proto_path<span style="color:#f92672">=</span>IMPORT_PATH --go_out<span style="color:#f92672">=</span>DST_DIR path/to/file.proto
</code></pre></div>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://blog.guagua.tech/tags/golang/">golang</a>

  <a class="tag tag--primary tag--small" href="https://blog.guagua.tech/tags/proto3/">proto3</a>

  <a class="tag tag--primary tag--small" href="https://blog.guagua.tech/tags/guide/">guide</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.guagua.tech/2018/09/grpc/" data-tooltip="gRPC in Go">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.guagua.tech/2018/09/using-gdb-on-macos/" data-tooltip="gdb on macOS">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.guagua.tech/2018/09/proto3-language-guide/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://blog.guagua.tech/2018/09/proto3-language-guide/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://blog.guagua.tech/2018/09/proto3-language-guide/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Li Zebang. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.guagua.tech/2018/09/grpc/" data-tooltip="gRPC in Go">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.guagua.tech/2018/09/using-gdb-on-macos/" data-tooltip="gdb on macOS">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.guagua.tech/2018/09/proto3-language-guide/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://blog.guagua.tech/2018/09/proto3-language-guide/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://blog.guagua.tech/2018/09/proto3-language-guide/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.guagua.tech%2F2018%2F09%2Fproto3-language-guide%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fblog.guagua.tech%2F2018%2F09%2Fproto3-language-guide%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3A%2F%2Fblog.guagua.tech%2F2018%2F09%2Fproto3-language-guide%2F">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
<script async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
  });
</script>
<script type="text/x-mathjax-config">
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script> 
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://avatars2.githubusercontent.com/u/26663453?s=460&amp;v=4" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Li Zebang</h4>
    
      <div id="about-card-bio">I hear and I forget, I see and I remember, I do and I understand.</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Student
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        China
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('https://blog.guagua.tech/images/cover.jpeg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://blog.guagua.tech/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
  




    
  </body>
</html>

